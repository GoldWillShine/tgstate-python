{% extends "base.html" %}

{% block title %}Settings - tgState{% endblock %}

{% block content %}
<div class="ui-shell" id="ui-settings">
  <div class="ui-row" style="align-items: center; justify-content: space-between;">
    <div>
      <h1 class="ui-title">Settings / Setup</h1>
      <p class="ui-sub">所有项都可跳过；支持部分保存，随时补全。</p>
    </div>
    <div class="ui-btns">
      <span class="ui-pill" id="cfg-pill">配置：—</span>
      <span class="ui-pill" id="bot-pill">Bot：—</span>
    </div>
  </div>

  <div class="ui-card ui-card-pad" style="margin-top: 14px;">
    <div class="ui-kv">
      <div>
        <div class="ui-k">当前访问来源</div>
        <div class="ui-v" id="site-origin">—</div>
      </div>
      <div>
        <div class="ui-k">进度</div>
        <div class="ui-v" id="step-count">0/3</div>
      </div>
      <div>
        <div class="ui-k">说明</div>
        <div class="ui-v" style="font-weight: 600; color: var(--ui-muted);">保存不一定启用；应用才会启停 Bot</div>
      </div>
    </div>
  </div>

  <div class="ui-card ui-card-pad" style="margin-top: 14px;">
    <div class="ui-row" style="align-items: center; justify-content: space-between;">
      <div>
        <div class="ui-title" style="font-size: 18px;">三步引导</div>
        <div class="ui-note">全部可跳过，后续可再补全。</div>
      </div>
    </div>

    <div class="ui-step" style="margin-top: 12px;">
      <div class="ui-step-item" id="step-1" data-done="0">
        <div><span class="ui-step-num">1</span><span class="ui-step-name">基础</span></div>
        <div class="ui-step-note">BOT_TOKEN / CHANNEL_NAME</div>
      </div>
      <div class="ui-step-item" id="step-2" data-done="0">
        <div><span class="ui-step-num">2</span><span class="ui-step-name">访问</span></div>
        <div class="ui-step-note">PASS_WORD / BASE_URL</div>
      </div>
      <div class="ui-step-item" id="step-3" data-done="0">
        <div><span class="ui-step-num">3</span><span class="ui-step-name">上传</span></div>
        <div class="ui-step-note">PICGO_API_KEY</div>
      </div>
    </div>
  </div>

  <div class="ui-row" style="margin-top: 14px;">
    <div class="ui-card ui-card-pad" style="flex: 1; min-width: 320px;">
      <div class="ui-title" style="font-size: 18px;">Step 1：基础</div>
      <div class="ui-note" style="margin-top: 6px;">Bot 只有在 BOT_TOKEN + CHANNEL_NAME 都存在且点击“保存并应用”后才会启动。</div>

      <div class="ui-form" style="margin-top: 12px;">
        <div class="ui-field">
          <div class="ui-label">
            <div>
              <div class="ui-label-main">BOT_TOKEN</div>
              <div class="ui-label-sub">用于访问 Telegram Bot API</div>
            </div>
            <div class="ui-btns">
              <span class="ui-pill" id="bot-token-mark">—</span>
              <span class="ui-label-sub" id="token-saved">—</span>
              <button type="button" class="ui-btn ui-mini" id="test-bot">测试</button>
            </div>
          </div>
          <input class="ui-in" id="bot-token" type="password" placeholder="123456:ABC..." autocomplete="off">
          <div class="ui-help" id="bot-token-help">—</div>
        </div>

        <div class="ui-field">
          <div class="ui-label">
            <div>
              <div class="ui-label-main">CHANNEL_NAME</div>
              <div class="ui-label-sub">@username 或 -100...</div>
            </div>
            <div class="ui-btns">
              <span class="ui-pill" id="chan-mark">—</span>
              <span class="ui-label-sub" id="chan-saved">—</span>
              <button type="button" class="ui-btn ui-mini" id="test-chan">测试</button>
            </div>
          </div>
          <input class="ui-in" id="chan-name" type="text" placeholder="@my_channel 或 -100123..." autocomplete="off">
          <div class="ui-help" id="chan-help">—</div>
        </div>
      </div>
    </div>

    <div class="ui-card ui-card-pad" style="flex: 1; min-width: 320px;">
      <div class="ui-title" style="font-size: 18px;">Step 2：访问</div>
      <div class="ui-note" style="margin-top: 6px;">PASS_WORD 用于 Web 登录（可空）；BASE_URL 用于生成分享链接（可空）。</div>

      <div class="ui-form" style="margin-top: 12px;">
        <div class="ui-field">
          <div class="ui-label">
            <div>
              <div class="ui-label-main">PASS_WORD</div>
              <div class="ui-label-sub">不设置则不启用登录保护</div>
            </div>
            <div class="ui-btns">
              <span class="ui-label-sub" id="pass-saved">—</span>
              <button type="button" class="ui-btn ui-mini" id="pass-eye">显示/隐藏</button>
            </div>
          </div>
          <input class="ui-in" id="pass-word" type="password" placeholder="输入登录密码（可留空）" autocomplete="new-password">
          <div class="ui-help">留空保存不会改变现有密码；需要清空请使用重置。</div>
        </div>

        <div class="ui-field">
          <div class="ui-label">
            <div>
              <div class="ui-label-main">BASE_URL</div>
              <div class="ui-label-sub">留空则默认使用当前访问来源</div>
            </div>
            <div class="ui-btns">
              <span class="ui-pill" id="base-mark">—</span>
              <span class="ui-label-sub" id="base-saved">—</span>
              <button type="button" class="ui-btn ui-mini" id="use-origin">一键使用当前来源</button>
            </div>
          </div>
          <input class="ui-in" id="base-url" type="text" placeholder="https://example.com（可留空）" autocomplete="off">
          <div class="ui-help" id="base-help">—</div>
        </div>
      </div>
    </div>
  </div>

  <div class="ui-card ui-card-pad" style="margin-top: 14px;">
    <div class="ui-title" style="font-size: 18px;">Step 3：上传</div>
    <div class="ui-note" style="margin-top: 6px;">PICGO_API_KEY 用于 API 上传鉴权（可空）。</div>

    <div class="ui-form" style="margin-top: 12px;">
      <div class="ui-field">
        <div class="ui-label">
          <div>
            <div class="ui-label-main">PICGO_API_KEY</div>
            <div class="ui-label-sub">可选：用于 PicGo / API 上传</div>
          </div>
          <div class="ui-btns">
            <span class="ui-label-sub" id="key-saved">—</span>
            <button type="button" class="ui-btn ui-mini" id="key-gen">生成</button>
            <button type="button" class="ui-btn ui-mini" id="key-copy">复制</button>
          </div>
        </div>
        <input class="ui-in" id="picgo-key" type="password" placeholder="留空则不启用 API Key 策略" autocomplete="off">
        <div class="ui-help">留空保存不会改变现有值；需要清空请使用重置。</div>
      </div>
    </div>
  </div>

  <div class="ui-card ui-card-pad" style="margin-top: 14px;">
    <div class="ui-title" style="font-size: 18px;">操作</div>
    <div class="ui-note" style="margin-top: 6px;">“保存并应用”会根据当前配置启停 Bot；“仅保存”不会触发任何启停动作。</div>
    <div class="ui-btns" style="margin-top: 12px;">
      <button type="button" class="ui-btn primary" id="btn-apply">保存并应用</button>
      <button type="button" class="ui-btn weak" id="btn-save">仅保存</button>
    </div>
  </div>

  <div class="ui-card ui-card-pad" style="margin-top: 14px;">
    <div class="ui-title" style="font-size: 18px; color: var(--ui-danger);">危险区</div>
    <div class="ui-note" style="margin-top: 6px;">重置会清空已保存的所有设置。</div>
    <div class="ui-btns" style="margin-top: 12px;">
      <button type="button" class="ui-btn danger" id="btn-reset">重置配置</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('nav-settings')?.classList.add('active');
});
</script>
{% endblock %}
