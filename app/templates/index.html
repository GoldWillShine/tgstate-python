{% extends "base.html" %}

{% block title %}Files - tgState{% endblock %}

{% block content %}
<div class="container">
    {% if not cfg.bot_ready %}
    <div class="ui-card ui-empty" style="margin-bottom: 14px;">
        <h2>功能未启用</h2>
        <p>上传/下载/删除需要配置 BOT_TOKEN 与 CHANNEL_NAME。</p>
        {% if cfg.missing %}
        <ul>
            {% for item in cfg.missing %}
            <li>{{ item }} 未填写</li>
            {% endfor %}
        </ul>
        {% endif %}
        <div class="ui-btns" style="margin-top: 12px;">
            <a class="ui-btn primary" href="/settings">去 Settings</a>
        </div>
    </div>
    {% endif %}

    <!-- Clean Upload Area -->
    <div class="upload-container">
        <div class="upload-area-dashed" id="upload-zone" data-bot-ready="{{ 1 if cfg.bot_ready else 0 }}">
            <p>拖拽文件到这里，或 <span>选择文件</span></p>
            <input type="file" id="file-picker" hidden multiple>
        </div>
        <div class="progress-area" id="prog-zone"></div>
        <div class="done-area" id="done-zone"></div>
    </div>

    <!-- Controls: Search & Batch Actions -->
    <div class="controls-bar">
        <div class="search-container">
            <input type="text" id="file-search" placeholder="Search files..." class="search-input">
        </div>
        <div class="batch-actions">
            <span id="selection-counter" class="text-muted" style="font-size: 0.875rem; margin-right: 8px;"></span>
            <button id="copy-links-btn" class="btn" disabled>Copy Links</button>
            <button id="batch-delete-btn" class="btn btn-danger" disabled>Delete</button>
        </div>
    </div>

    <!-- File List Table -->
    <div class="file-list-container">
        <div class="file-list-header">
            <div class="col-checkbox"><input type="checkbox" id="select-all-checkbox"></div>
            <div class="col-name">Name</div>
            <div class="col-size">Size</div>
            <div class="col-date">Date</div>
            <div class="col-actions">Actions</div>
        </div>
        <div class="file-list" id="file-list-disk">
            {% if files %}
                {% for file in files %}
                <div class="file-item" id="file-item-{{ file.file_id.replace(':', '-') }}" data-file-id="{{ file.file_id }}" data-file-url="/d/{{ file.file_id }}/{{ file.filename }}" data-filename="{{ file.filename }}">
                    <div class="col-checkbox">
                        <input type="checkbox" class="file-checkbox" data-file-id="{{ file.file_id }}">
                    </div>
                    <div class="col-name">
                        <span title="{{ file.filename }}">{{ file.filename }}</span>
                    </div>
                    <div class="col-size">{{ "%.2f" | format(file.filesize / (1024*1024)) }} MB</div>
                    <div class="col-date">{{ file.upload_date.split(' ')[0] }}</div>
                    <div class="col-actions">
                        <a href="/d/{{ file.file_id }}/{{ file.filename }}" class="action-btn" data-tooltip="Download">Download</a>
                        <button class="action-btn copy-link-btn" data-tooltip="Copy Link" onclick="copyLink('/d/{{ file.file_id }}/{{ file.filename }}')">Copy</button>
                        <button class="action-btn delete" data-tooltip="Delete" onclick="deleteFile('{{ file.file_id }}')">Delete</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="padding: 40px; text-align: center; color: var(--text-tertiary);">
                    <p>No files found</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
<script src="{{ url_for('static', path='/js/main.js') }}?v=3.0"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('nav-home')?.classList.add('active');
});
</script>
{% endblock %}
